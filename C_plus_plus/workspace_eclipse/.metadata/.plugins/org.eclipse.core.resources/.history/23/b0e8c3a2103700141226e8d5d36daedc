
/*============================================================================
// Name        : opt_out1.cpp
// Author      : Hong Pan
// Version     :
// Copyright   : NONE
// Description : ecen489_fall_2014 opt_out1 assignment
//notes:
    in = read from file
    out = write to file
	ofstream: Stream class to write on files
	ifstream: Stream class to read from files
	fstream: Stream class to both read and write from/to files.
	strtod(): http://www.cplusplus.com/reference/cstdlib/strtod/
============================================================================*/

#include <iostream>
#include <fstream>	//fstream
#include <vector>	//vector
#include <stdlib.h>	// strtod() string to double
#include <string>	//to_string()
#include <sstream>

using namespace std;

string temp_convert(vector<string> msg_vector, bool cel_fah);
double cel_kel (double temp);	//convert Celsius to Kelvin
double fah_kel (double temp);	//convert Fahrenheit to Kelvin

int main() {
	fstream temp_txt_file;
	temp_txt_file.open("C:\\Users\\hpan\\Documents\\tamu\\eclipse_workspace\\opt_out1\\temp_file.txt");
	if (temp_txt_file.is_open()) {
		vector<string> msg_vector;
		string msg_string = " ";
		//store the content of the txt file to a vector and process
		while(!temp_txt_file.eof()) {
			getline(temp_txt_file, msg_string);
			if (msg_string == "\t\t\"tempunit\":\"Celsius\"") {
				msg_string = "\t\t\"tempunit\":\"Kelvin\"";
				msg_vector[msg_vector.size()-1] = temp_convert(msg_vector, true);	//if the unit is in celsius, pass "true"
			} else if (msg_string == "\t\t\"tempunit\":\"Fahrenheit\"") {
				msg_string = "\t\t\"tempunit\":\"Kelvin\"";
				msg_vector[msg_vector.size()-1] = temp_convert(msg_vector, false);	//if the unit is in fahrenheit, pass "false"
			}	//end of else if
			msg_vector.push_back(msg_string);
		}	//end of while

		//replace the content of txt file
		for(unsigned int i=0; i < msg_vector.size(); ++i) {
			temp_txt_file << msg_vector[i];
			cout << msg_vector[i] << endl;
		}	//end of for
		temp_txt_file.close();
	} else {
		cout << "Unable to open file";
	}

	return 0;
}

string temp_convert(vector<string> msg_vector, bool cel_fah) {
	double temp = 0;
	string buff1 = msg_vector[msg_vector.size()-1];
	for (unsigned int i=0; i<buff1.size(); ++i) {
		if(buff1[i] == ':') {
			string buff2 = buff1.substr(i+1, buff1.size()-1);
			char* temp_ptr;
			temp = strtod(buff2.c_str(), &temp_ptr);
			if (cel_fah) temp = cel_kel(temp);	//if cel_fah = true, the unit is celsius; otherwise, it's in fahrenheit
			else temp = fah_kel(temp);
			stringstream ss;
			ss << temp;
			buff2 = ss.str();
			buff1.replace(i+1, buff1.size()-i-2, buff2);
			break;
		} //end of if
	}	//end of for
	return buff1;
}	//end of temp_convert

double cel_kel (double temp_cel) {	//convert Celsius to Kelvin
	double temp_kel = 0.0;
	temp_kel = temp_cel + 273.15;
	return temp_kel;
}

double fah_kel (double temp_fah) {	//convert Fahrenheit to Kelvin
	double temp_kel = 0.0;
	temp_kel = (temp_fah-32.0) * 5.0/9.0 +273.15;
	return temp_kel;
}
